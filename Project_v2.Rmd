---
title: "Burlington Fire Department Incidents & Response Times, 2018 - 2019"
author: "Clay Chisholm, Ethan Lauricella & Luc√≠a Carrera"
date: "10/17/2021"
output: html_document
---

<br>

## Introduction

The data set we are analyzing today is based on data from the Burlington Fire Department. This data includes info on incident types and response times from Aug 1, 2018, through November 30, 2019. Data was pulled from the fire department RMS database. There is no sample bias as the data is strictly incident responses of the fire department. This data is an observational study to see the time taken from call to response of the fire department and locations of incidents. The only bias that is seen is possibility in rounding times to the nearest minute, but this is understandable and would not affect the results. 

We believe this data could be very interesting to understand for what reasons the population of Burlington most frequently call the fire department, as well as, the efficiency and speed that they have. Because this city has a large population of students we are also intrigued to see if the large influx of college students during the fall and spring semester change the data, for example: the reasons for the calls and the times these emergencies occur. Another factor we believe could strong affect our data would be the winter season, as Vermont is known for being very cold, this could change the reasons to why the fire department was called.

To be able to use this data set we had to do some cleaning: the most important part was to change the names of our variables due to them being very long and incomprehensible. We also modified the geopoint column by separating and creating two new variables, Longitude and Latitude. This was done to be able to use Leaflet to plot coordinates.

<br>

## Data Setup & Cleaning

```{r setup, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Loading of packages we will use for our project
library(tidyverse)
library(lubridate)
library(leaflet)
library(gridExtra)

# Loading of the data frame fire to use
fire <- read.csv("O_fire_new.csv", na.strings = '', stringsAsFactors = TRUE)

# Result summaries of our data
tibble(fire)

# Visualization of the different variables available in our data set
names(fire)

## The names of our variables were summarized by r studio leading to names such as "Disp_d....m", to be able to clearly use our data we decided to modify these names for ease of use.

# Incident number
names(fire)[3] <- "Inc_num"

# Incident description
names(fire)[4] <- "Inc_des"

# Alarm date and time
names(fire)[5] <- "Alm_dt"

# Dispatch date and time
names(fire)[6] <- "Dis_dt"

# Dispatch Notified Date and Time
names(fire)[7] <- "Not_dt"

# Unit responding Date and Time
names(fire)[8] <- "Roll_dt"

# Arrival Date and Time
names(fire)[9] <- "Arv_dt"

# In Service Time
names(fire)[10] <- "Ins_dt"


##  We decided to add lattitude and longitude columns  
fire <- fire %>% mutate(geopoint2 = str_sub(geopoint, 1,-1)) %>%  
  separate(geopoint2, into = c('Lat', 'Long'), sep = ',')

fire <- fire %>% mutate(Long = as.numeric(Long), Lat =as.numeric(Lat))

names(fire)
```

<br>

## Data Analysis

### Time of Calls

```{r Time of Calls, message=FALSE, warning=FALSE}
# The first graph we wanted to map out is the time of calls to see at what were the most "popular" times to call 
alarm <- fire %>% mutate(Call = mdy_hm(Alm_dt), 
                   Weekday = wday(Call, label = TRUE),
                   Mon = month(Call, label = TRUE),
                   Date = date(Call),
                   Hour = hour(Call))

# 
ggplot(data = alarm, 
       mapping = aes(x= Hour)) +
  geom_histogram(color = 'purple', fill = 'pink')
  

```

<br>

### Location of Calls

```{r Location of Calls, message=FALSE, warning=FALSE}
#  Do a scatterplot of Latitude by Longitude, to see where calls are made in Burlington. Do you recognize the shape of the data?


# Location of Calls
ggplot(data = fire,
mapping = aes(x = Long, y = Lat )) +
  geom_point()

#  Using leaflet, make a map showing circles on the location of each incident.  Start here:
m <- leaflet() %>%
  addTiles() %>%
  setView(lat = 44.475, lng = -73.212, zoom = 12)

#  (Once you get the leaflet plot working, remove the scatterplot of Longitude by Latitude)
m  %>% addCircles(lng = fire$Long, lat = fire$Lat)

```

<br>

### Amount of times a Unit responds to call

```{r Amount of times a Unit responds to call, message=FALSE, warning=FALSE}
f2 <- fire %>% group_by(Unit) %>% summarize(count = n()) %>% arrange(desc(count)) %>% select(Unit = Unit, count = count)
f2
ggplot(data = fire, mapping = aes(x = Unit, fill = Unit) )+
  geom_bar()+ theme(axis.text.x = element_text(hjust=1, angle = 60)) + 
  scale_x_discrete(limits = f2$Unit)

```

<br>

### Type of incident description

```{r Type of incident description, message=FALSE, warning=FALSE}
incident <- fire %>% group_by(Inc_des) %>% summarize(count = n()) %>% select(Inc_des = Inc_des, count = count) %>% arrange(desc(count)) %>% filter(count > 90)
incident
ggplot(data = fire, mapping = aes(x = Inc_des, fill = Inc_des))+
  geom_bar()+#theme(axis.text.x = element_text(hjust=1, angle = 60+  # We have an issue here
  scale_x_discrete(limits = incident$Inc_des)+theme(legend.position = 'none')

```

Around August the calls seem to double in frequency. This could be possible because the UVM student body is back in full swing.

<br>

### Month by shifts

```{r Month by shifts, message=FALSE, warning=FALSE}
shift_time <- fire %>% filter(!is.na(Shift)) %>% mutate(Call = mdy_hm(Dis_dt),
                   Weekday = wday(Call, label = TRUE),
                   Mon = month(Call, label = FALSE),
                   Date = date(Call),
                   Hour = hour(Call))
names(shift_time)
ggplot(data = shift_time, mapping = aes(x= Mon, fill = Shift))+
  geom_histogram()


```

<br>

### Amount of time at each incident

This plot shows the time spent at each incident in minutes. Most incidents only take about 20 minutes at the site. There is some cases where the shift is needed at a site for a long time. Most incidents are EMS calls, thus this makes sense as they most likely arrive at the scene and call for an ambulence to deliver the patient to a medical facility.

```{r Amount of time at each incident, message=FALSE, warning=FALSE}

# Time spent at each site, A_ being the arrival time, and D_ being the departure time
# new data frame inc_time with the na's filtered out
inc_time <- fire %>%
  filter(!is.na(Alm_dt)) %>% 
  filter(!is.na(Inc_des)) %>%
  # create new columns to be able to differentiate months, date, hour, minute for arrival call and departure call
  mutate(ACall = mdy_hm(Alm_dt),
         AWeekday = wday(ACall, label = TRUE),
         AMon = month(ACall, label = TRUE),
         ADate = date(ACall),
         AHour = hour(ACall),
         AMin = minute(ACall)) %>%
  mutate(DCall = mdy_hm(Ins_dt),
         DWeekday = wday(DCall, label = TRUE),
         DMon = month(DCall, label = TRUE),
         DDate = date(DCall),
         DHour = hour(DCall),
         DMin = minute(DCall))

inc_time <- inc_time %>% 
  mutate(time_workd = (DDate - ADate)*24*60,
         time_workh = (DHour - AHour)*60,
         time_workm = DMin - AMin,
         total_m = time_workh + time_workm + time_workd)

inc_time <- inc_time %>% filter(!is.na(inc_time))


ggplot(data = inc_time, mapping = aes(x= total_m, fill = Shift))+
  geom_histogram(binwidth = 4) + labs(title = "Time spent at each incident site (minutes)")

```

<br>

## Conclusions

"the conclusion"
